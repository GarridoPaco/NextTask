function selectCollaborators(e){const o=document.querySelector("#selectAssignment");o.innerHTML='<option value="" disabled selected style="display:none;">Seleccione un colaborador</option>',e.forEach(e=>{const t=document.createElement("OPTION");t.classList.add("assignmentOption"),t.value=e.id,t.textContent=e.name+" "+e.last_name,o.appendChild(t)})}async function showCollaborators(e,o,t){selectCollaborators(t);const a=document.querySelector("#collaboratorsContainer");let n=document.querySelector("#collaboratorsList");if(n.innerHTML="",0===t.length){const e=document.createElement("P");return e.textContent="No hay colaboradores asignados a este proyecto. Haz click en el botón de abajo para añadir colaboradores a tu proyecto.",e.classList.add("no-collaborators"),void a.insertBefore(e,n.nextSibling)}const l=document.querySelector(".no-collaborators");l&&l.remove(),t.forEach(a=>{const l=document.createElement("DIV");l.classList.add("containerCollaborator");const i=document.createElement("DIV");i.classList.add("collaboratorInfo");const c=document.createElement("IMG");c.classList.add("collaboratorImg"),c.src=`build/img/${a.image}.jpg`;const r=document.createElement("P");r.classList.add("collaboratorName"),r.textContent=a.name+" "+a.last_name;const s=document.createElement("IMG");s.title="Eliminar colaborador",s.src="build/img/delete_icon.svg",s.classList.add("actionImg"),s.onclick=async function(){const n=await getAssign();Swal.fire({title:"¿Estás seguro que quieres eliminar al colaborador?",text:"Esta operación no es reversible",icon:"warning",iconColor:"#0075beff",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Borrar"}).then(l=>{l.isConfirmed&&(n.forEach(o=>{o.user_id===a.id&&o.project_id===e.id&&deleteAssign(o)}),deleteCollaborator(o,t,a,e))})},n.appendChild(l),l.appendChild(s),l.appendChild(i),i.appendChild(c),i.appendChild(r)})}async function showUsers(e,o){var t=document.querySelector("#checkboxCollaborators");t.innerHTML="",e.forEach(e=>{const a=document.createElement("DIV");a.classList.add("checkboxCollaborator");const n=document.createElement("input");n.type="checkbox",n.name="collaboratorCheckbox",n.value=e.id,n.id="collaboratorCheckbox"+e.id;let l=o.find((function(o){return o.id===e.id}));n.disabled=!!l;const i=document.createElement("label");i.classList.add("userLabel"),i.htmlFor="collaboratorCheckbox"+e.id;const c=document.createElement("IMG");c.classList.add("userImg"),c.src=`build/img/${e.image}.jpg`;const r=document.createElement("P");r.classList.add("userName"),r.textContent=`${e.name} ${e.last_name}`,i.appendChild(c),i.appendChild(r),t.appendChild(a),a.appendChild(n),a.appendChild(i)})}async function collaboratorsModal(e,o){let t=await getCollaborators();document.querySelector("#collaboratorModal").style.display="flex";const a=document.querySelector("#addCollaboratorBtn"),n=function(l){l.preventDefault();const i=document.querySelectorAll('input[name="collaboratorCheckbox"]:checked'),c=[];for(let e=0;e<i.length;e++)c.push(i[e].value);0!==i.length?(addCollaborator(c,e,t,o),a.removeEventListener("click",n)):infoAction.fire({icon:"error",title:"Selecccione algún colaborador"})};a.addEventListener("click",n)}async function addCollaborator(e,o,t,a){const n=e.join(","),l=new FormData;l.append("user_id",n),l.append("url",getUrlProject());try{const n=location.origin+"/api/collaboration",i=await fetch(n,{method:"POST",body:l}),c=await i.json();if(showAlert(c.message,c.type),"exito"===c.type){document.querySelector("#collaboratorModal").style.display="none",infoAction.fire({icon:"success",title:c.message});e.map(e=>o.find(o=>o.id===e)).forEach(e=>{t.push(e)}),showCollaborators(a,o,t),showUsers(o,t)}}catch(e){infoAction.fire({icon:"error",title:"No se ha podido añadir al colaborador"}),console.log(e)}}async function deleteCollaborator(e,o,t,a){const n=new FormData;n.append("user_id",t.id),n.append("url",getUrlProject());try{const l=location.origin+"/api/collaboration/delete",i=await fetch(l,{method:"POST",body:n}),c=await i.json();"exito"===c.type&&(infoAction.fire({icon:"success",title:c.message}),showCollaborators(a,e,o=o.filter(e=>e.id!==t.id)),showUsers(e,o))}catch(e){infoAction.fire({icon:"error",title:"No se ha podido realizar la asignación"}),console.log(e)}}async function invitation(){const e=document.getElementById("invitationBtn"),o=document.getElementById("loader-invitation");o.style.display="block",e.style.display="none";const t=document.getElementById("invitationEmail").value,a=new FormData;a.append("invitationEmail",t);try{const t=location.origin+"/invitation",n=await fetch(t,{method:"POST",body:a}),l=await n.json();e.style.display="block",o.style.display="none","exito"===l.type?(document.getElementById("invitationEmail").value="",infoAction.fire({icon:"success",title:l.message})):infoAction.fire({icon:"error",title:l.message})}catch(t){e.style.display="block",o.style.display="none",infoAction.fire({icon:"error",title:"No se ha podido enviar el email"}),console.log(t)}}