function viewComment(e,t,n,o){const i=document.createElement("DIV");i.classList.add("commentContainer"),i.dataset.user_id=e.user_id;const a=document.createElement("DIV");a.classList.add("commentActions");const c=document.createElement("DIV");c.classList.add("arrowTextComment");const d=document.createElement("P");d.classList.add("textComment"),d.textContent=e.text;const s=document.createElement("DIV");s.classList.add("infoUserComment");const r=document.createElement("IMG");r.classList.add("userImg"),r.src=`build/img/profile/${e.user_image}.jpg`;const m=document.createElement("P");m.classList.add("userComment"),n.id===e.user_id?m.textContent="Tú":m.textContent=e.user_name;const l=document.createElement("P");l.classList.add("dateComment"),l.textContent=formatDate(e.Timestamp);const u=document.createElement("IMG");u.title="Eliminar comentario",u.src="build/img/delete_icon.svg",u.classList.add("deleteCommentBtn"),u.classList.add("actionImg"),a.appendChild(u),u.onclick=function(t){Swal.fire({title:"¿Estás seguro que quieres eliminar el comentario?",text:"Esta operación no es reversible",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Borrar"}).then(n=>{if(n.isConfirmed){const n=t.target.closest(".commentContainer");deleteComment(e,n)}})};const p=document.createElement("IMG");p.title="Editar comentario",p.src="build/img/edit_icon.svg",p.classList.add("editCommentBtn"),p.classList.add("actionImg"),a.appendChild(p),p.onclick=function(t){let n=t.target.closest(".commentContainer").querySelector(".textComment");editCommentModal({text:e.text,id:e.id,task_id:e.task_id},n)},i.appendChild(a),n.id!==e.user_id&&o.user_id!==n.id&&(a.style.display="none"),i.appendChild(s),i.appendChild(c),i.appendChild(d),s.appendChild(r),s.appendChild(m),i.appendChild(l),t.appendChild(i)}function newCommentsModal(e,t,n){const o=document.querySelector("#commentModal");o.style.display="flex";const i=document.querySelector("#addCommentBtn");i.textContent="Enviar Comentario",document.querySelector("#modalCommentLegend").textContent="Nuevo Comentario";let a=o.querySelector("#commentText");a.value="";const c=function(o){o.preventDefault();let d=[];a=a.value.trim(),""!==a?(d={text:a,task_id:e,user_id:t.id},addComment(d,t,n),i.removeEventListener("click",c)):infoAction.fire({icon:"error",title:"El comentario no puede estar vacio"})};i.addEventListener("click",c)}function editCommentModal(e,t){document.querySelector("#commentModal").style.display="flex";const n=document.querySelector("#addCommentBtn");n.textContent="Editar comentario",document.querySelector("#modalCommentLegend").textContent="Editar Comentario";let o=document.querySelector("#commentText").value=e.text;const i=function(a){a.preventDefault(),o=document.querySelector("#commentText").value.trim(),""!==o?(updateComment(e={text:o,id:e.id,task_id:e.task_id},t),n.removeEventListener("click",i)):infoAction.fire({icon:"error",title:"El comentario no puede estar vacio"})};n.addEventListener("click",i)}async function addComment(e,t,n){const o=new FormData;o.append("task_id",e.task_id),o.append("text",e.text),o.append("url",getUrlProject());try{const i=location.origin+"/api/comment/create",a=await fetch(i,{method:"POST",body:o}),c=await a.json();if("exito"===c.type){document.querySelector("#commentModal").style.display="none";const o=document.querySelector(`.taskContainer[data-task-id="${e.task_id}"]`).querySelector(".taskContentContainer");o.classList.add("active");const i=o.querySelector(".taskComments");viewComment({id:c.comment_id,task_id:e.task_id,user_id:t.id,text:e.text,user_image:t.image,user_name:`${t.name} ${t.last_name}`,Timestamp:new Date},i,t,n),infoAction.fire({icon:"success",title:c.message})}}catch(e){infoAction.fire({icon:"error",title:"No se ha podido añadir el comentario"}),console.log(e)}}async function updateComment(e,t){document.querySelector(`.taskContainer[data-task-id="${e.task_id}"]`).querySelector(".taskContentContainer").classList.add("active");const n=new FormData;n.append("id",e.id),n.append("task_id",e.task_id),n.append("text",e.text),n.append("url",getUrlProject());try{const o=location.origin+"/api/comment/update",i=await fetch(o,{method:"POST",body:n}),a=await i.json();if("exito"===a.type){document.querySelector("#commentModal").style.display="none",t.textContent=e.text,infoAction.fire({icon:"success",title:a.message})}}catch(e){infoAction.fire({icon:"error",title:"No se ha podido actualizar el comentario"}),console.log(e)}}async function deleteComment(e,t){document.querySelector(`.taskContainer[data-task-id="${e.task_id}"]`).querySelector(".taskContentContainer").classList.add("active");const n=new FormData;n.append("id",e.id),n.append("url",getUrlProject());try{const e=location.origin+"/api/comment/delete",o=await fetch(e,{method:"POST",body:n}),i=await o.json();"exito"===i.type&&(t.style.display="none",infoAction.fire({icon:"success",title:i.message}))}catch(e){infoAction.fire({icon:"error",title:"No se ha podido eliminar la tarea"}),console.log(e)}}