async function addAssign(e,t,n,o,a){const s=new FormData;s.append("user_id",e),s.append("task_id",o.id),s.append("deadline",o.deadline),s.append("url",getUrlProject());try{const i=location.origin+"/api/assignment",l=await fetch(i,{method:"POST",body:s}),r=await l.json();if(showAlert(r.message,r.type),"exito"===r.type){document.querySelector("#assignmentsModal").style.display="none";const s=document.querySelector(`.taskContainer[data-task-id="${o.id}"]`);s.querySelector(".taskContentContainer").classList.add("active");const i=document.querySelector(`.taskAssignContainer[data-task_id="${o.id}"]`);i.style.display="block";const l=i.querySelector(".taskCollaboratorsContainer");viewAssignment(t,n,o,{user_id:e,task_id:o.id,deadline:o.deadline},a,l),infoAction.fire({icon:"success",title:r.message})}}catch(e){infoAction.fire({icon:"error",title:"No se ha podido realizar la asignación"}),console.log(e)}}async function deleteAssign(e){const t=new FormData;t.append("user_id",e.user_id),t.append("task_id",e.task_id),t.append("url",getUrlProject());try{const n=location.origin+"/api/assignment/delete",o=await fetch(n,{method:"POST",body:t}),a=await o.json();if("exito"===a.type){const t=document.querySelector(`.taskContainer[data-task-id="${e.task_id}"]`);t.querySelector(".taskContentContainer").classList.add("active");t.querySelector(`.taskCollaborator[data-collaborator-id="${e.user_id}"]`).remove();const n=document.querySelector(`.taskAssignContainer[data-task_id="${e.task_id}"]`);0===n.querySelector(".taskCollaboratorsContainer").children.length&&(n.style.display="none"),infoAction.fire({icon:"success",title:a.message})}}catch(e){infoAction.fire({icon:"error",title:"No se ha podido eliminar el colaborador"}),console.log(e)}}function assignmentsModal(e,t,n){document.getElementById("selectAssignment").selectedIndex=0;let o=[];const a=document.querySelectorAll(".assignmentOption");a.forEach(e=>{e.style.display="block";const t=e.textContent.split(" "),n={id:e.value,name:t[0],last_name:t.slice(1).join(" ")};o.push(n)});const s=document.querySelector(`.taskAssignContainer[data-task_id="${e.id}"]`).querySelectorAll(".taskCollaborator");let i=[];s.forEach(e=>{i.push(e.dataset.collaboratorId)});let l=o.filter((function(e){return i.includes(e.id)}));if(a.forEach(e=>{l.some((function(t){return e.value===t.id}))&&(e.style.display="none")}),l.length===a.length)return void Swal.fire({title:"Asignar tarea",text:"No hay más colaboradores disponibles",icon:"warning",confirmButtonColor:"#0075beff"});const r=document.querySelector("#assignmentsModal");r.style.display="flex";const d=function(a){a.preventDefault();addAssign(document.querySelector("#selectAssignment").value,t,n,e,o),r.style.display="none",addAssignmentsBtn.removeEventListener("click",d)};addAssignmentsBtn.addEventListener("click",d)}function viewAssignment(e,t,n,o,a,s){if(o.task_id===n.id){const n=document.createElement("DIV");n.classList.add("taskCollaborator"),n.dataset.collaboratorId=o.user_id;const i=document.createElement("DIV");i.classList.add("collaboratorContainer");const l=a.find(e=>e.id===o.user_id),r=document.createElement("P");r.classList.add("collaboratorName"),r.textContent=`${l.name} ${l.last_name}`;const d=document.createElement("IMG");d.src="build/img/delete_icon.svg",d.title="Eliminar colaborador",d.classList.add("deleteCollaboratorBtn"),e.id!==t.user_id&&(d.style.display="none"),d.classList.add("actionImg"),d.onclick=function(){Swal.fire({title:"¿Estás seguro que quieres eliminar la asignación?",text:"Esta operación no es reversible",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Borrar"}).then(e=>{e.isConfirmed&&deleteAssign(o)})},i.appendChild(r),n.appendChild(i),n.appendChild(d),s.appendChild(n)}}