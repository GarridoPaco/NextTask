const mobileMenuBtn=document.querySelector("#mobileMenuBtn"),mobileCloseBtn=document.querySelector("#mobileCloseBtn"),sidebar=document.querySelector(".sidebar");mobileMenuBtn&&mobileMenuBtn.addEventListener("click",(function(){sidebar.classList.add("show"),console.log("menu mobile")})),mobileCloseBtn&&mobileCloseBtn.addEventListener("click",(function(){sidebar.classList.add("hide"),sidebar.classList.remove("show"),sidebar.classList.remove("hide")})),window.addEventListener("resize",(function(){document.body.clientWidth>=768&&sidebar.classList.remove("show")}));const navViews=document.querySelector("#navViews"),barra=document.querySelector(".barra");navViews||(barra.style.borderRadius="1rem");const closeModalBtns=document.querySelectorAll(".closeModal");function formatDate(e){const t=new Date(e),n=t.getMonth(),s=t.getDate(),a=t.getFullYear();return new Date(Date.UTC(a,n,s)).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function closeModal(){document.querySelectorAll(".modal-overlay").forEach((function(e){e.style.display="none"}))}function showContentTask(){document.querySelectorAll(".toggleBtn").forEach((function(e){e.addEventListener("click",(function(){const t=this.nextElementSibling;t.classList.toggle("active"),t.classList.contains("active")?e.src="build/img/up_arrow_icon.svg":e.src="build/img/down_arrow_icon.svg"}))}))}function taskActionsMenu(){document.querySelectorAll(".taskActionsBtn").forEach((function(e){e.addEventListener("click",(function(){const t=this.nextElementSibling;t.classList.toggle("active"),t.classList.contains("active")?e.src="build/img/right_arrow_icon.svg":e.src="build/img/dots_three_circle_icon.svg"}))}))}function showAlert(e,t){const n=document.querySelector(".alerta");n&&n.remove();const s=document.createElement("DIV");s.classList.add("alerta",t),s.textContent=e;const a=document.querySelector("legend");a.parentElement.insertBefore(s,a.nextElementSibling),setTimeout(()=>{s.remove()},5e3)}async function taskBin(e,t,n,s,a,i){return new Promise(async d=>{const c=document.createElement("LI");c.dataset.taskId=e.id,c.classList.add("taskContainer");const o=document.createElement("input");o.type="checkbox",o.classList.add("checkTask"),o.disabled=!0;const l=document.createElement("DIV");l.classList.add("taskHeader"),l.appendChild(o);const r=document.createElement("P");r.textContent=e.title,r.classList.add("taskName"),l.appendChild(r);const m=document.createElement("IMG");m.classList.add("toggleBtn"),m.classList.add("actionImg"),m.alt="Desplegar contenido",m.title="Mostrar información adicional",m.src="build/img/down_arrow_icon.svg";const u=document.createElement("DIV");u.classList.add("taskContentContainer");const p=document.createElement("DIV");p.classList.add("taskInfo");const g=document.createElement("DIV");g.classList.add("taskDescription");const C=document.createElement("IMG");C.classList.add("taskDescriptionIcon"),C.alt="Descripción de la tarea",C.src="build/img/info_icon.svg",C.title="Descripción de la tarea",g.appendChild(C);const h=document.createElement("P");h.classList.add("taskDescriptionText"),""===e.description?h.textContent="Sin descripción":h.textContent=e.description,g.appendChild(h),p.appendChild(g);const k=document.createElement("DIV");k.classList.add("taskPriority");const E=document.createElement("DIV");E.classList.add("taskPriorityColor");E.title="Prioridad de la tarea",E.style.backgroundColor=["#82E0AA","#F7DC6F","#F1948A"][e.priority],k.appendChild(E);const L=document.createElement("P");L.classList.add("taskPriorityText");L.textContent="Prioridad "+["Baja","Normal","Alta"][e.priority],k.appendChild(L),p.appendChild(k);const y=document.createElement("DIV");y.classList.add("taskStatus");const b=document.createElement("IMG");b.classList.add("taskStatusIcon");b.alt="Imagen del estado de la tarea",b.src=["build/img/pendiente_icon.svg","build/img/progress_icon.svg","build/img/complete_icon.svg"][e.status],b.title="Estado de la tarea",y.appendChild(b);const f=document.createElement("P");f.classList.add("taskStatusText");f.textContent=""+["Pendiente","En Progreso","Finalizada"][e.status],y.appendChild(f),p.appendChild(y);const v=document.createElement("DIV");v.classList.add("taskDeadline");const I=document.createElement("IMG");I.classList.add("taskDeadlineIcon"),I.alt="Imagen de la fecha de entrega de la tarea",I.src="build/img/deadline_icon.svg",I.title="Fecha de entrega",v.appendChild(I);const w=document.createElement("P");w.classList.add("taskDeadlineText"),w.textContent=formatDate(e.deadline),v.appendChild(w),p.appendChild(v);const D=document.createElement("DIV");D.classList.add("taskActionsContainer");const _=document.createElement("DIV");_.classList.add("taskActions");const B=document.createElement("IMG");B.title="Menú de acciones",B.src="build/img/dots_three_circle_icon.svg",B.classList.add("taskActionsBtn"),B.classList.add("actionImg");const M=document.createElement("IMG");M.title="Editar tarea",M.src="build/img/edit_icon.svg",M.classList.add("editTaskBtn"),M.classList.add("actionImg"),M.onclick=function(){editTaskModal(e,a,i)};const A=document.createElement("IMG");A.title="Eliminar tarea",A.src="build/img/delete_icon.svg",A.classList.add("deleteTaskBtn"),A.classList.add("actionImg"),A.onclick=function(){Swal.fire({title:"¿Estás seguro que quieres eliminar la tarea?",text:"Esta operación no es reversible",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Borrar"}).then(async t=>{if(t.isConfirmed&&await deleteTask(e)){let e=await getTasks();generalView&&(showTasks(e,a,i),showCalendar(e,a,i)),kanbanView&&showTasksKanban()}})};const S=document.createElement("IMG");S.title="Asignar tarea",S.src="build/img/assign_icon.svg",S.classList.add("assignTaskBtn"),S.classList.add("actionImg"),S.onclick=function(){assignmentsModal(e,a,i)};const T=document.createElement("IMG");T.title="Añadir comentario",T.src="build/img/comment_icon.svg",T.classList.add("commentTaskBtn"),T.classList.add("actionImg"),T.onclick=function(){newCommentsModal(e.id,a,i)};const V=document.createElement("DIV");V.classList.add("taskAssignContainer"),V.dataset.task_id=e.id;const x=document.createElement("H4");x.classList.add("taskAssignTitle"),x.textContent="Asignado a:";const q=document.createElement("DIV");q.classList.add("taskCollaboratorsContainer"),V.appendChild(x),V.appendChild(q);let P=new Array;t.some((function(t){return t.task_id===e.id}))?t.forEach(t=>{t.task_id===e.id&&P.push(t.user_id),viewAssignment(a,i,e,t,n,q)}):V.style.display="none";const G=document.createElement("DIV");G.classList.add("taskComments");const F=await getComments(e.id);if(F.length){const e=document.createElement("H4");e.classList.add("taskCommentsTitle"),e.textContent="Comentarios:",G.appendChild(e),F.forEach(e=>{viewComment(e,G,a,i)})}if(_.appendChild(A),_.appendChild(M),_.appendChild(S),_.appendChild(T),D.appendChild(B),D.appendChild(_),c.appendChild(D),c.appendChild(l),c.appendChild(m),c.appendChild(u),u.appendChild(p),u.appendChild(V),u.appendChild(G),s.appendChild(c),a.id!==i.user_id){D.style.display="none",A.style.display="none",M.style.display="none",T.style.display="none",S.style.display="none";document.querySelectorAll("#addTask").forEach(e=>{e.style.display="none"})}(P.includes(a.id)||i.user_id===a.id)&&(o.disabled=!1,D.style.display="block",M.style.display="block",T.style.display="block"),generalView&&(o.style.display="none"),2==e.status&&(o.checked=!0,o.disabled=!0),d(c)})}closeModalBtns.forEach((function(e){e.addEventListener("click",closeModal)}));