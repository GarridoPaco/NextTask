const mobileMenuBtn=document.querySelector("#mobileMenuBtn"),mobileCloseBtn=document.querySelector("#mobileCloseBtn"),sidebar=document.querySelector(".sidebar");mobileMenuBtn&&mobileMenuBtn.addEventListener("click",(function(){sidebar.classList.add("show"),console.log("menu mobile")})),mobileCloseBtn&&mobileCloseBtn.addEventListener("click",(function(){sidebar.classList.add("hide"),sidebar.classList.remove("show"),sidebar.classList.remove("hide")})),window.addEventListener("resize",(function(){document.body.clientWidth>=768&&sidebar.classList.remove("show")}));const navViews=document.querySelector("#navViews"),barra=document.querySelector(".barra");navViews||(barra.style.borderRadius="1rem");const closeModalBtns=document.querySelectorAll(".closeModal");function formatDate(e){const t=new Date(e),n=t.getMonth(),s=t.getDate(),a=t.getFullYear();return new Date(Date.UTC(a,n,s)).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function closeModal(){document.querySelectorAll(".modal-overlay").forEach((function(e){e.style.display="none"}))}function showContentTask(){document.querySelectorAll(".toggleBtn").forEach((function(e){e.addEventListener("click",(function(){const t=this.nextElementSibling;t.classList.toggle("active"),t.classList.contains("active")?e.src="build/img/up_arrow_icon.svg":e.src="build/img/down_arrow_icon.svg"}))}))}function taskActionsMenu(){document.querySelectorAll(".taskActionsBtn").forEach((function(e){e.addEventListener("click",(function(){const t=this.nextElementSibling;t.classList.toggle("active"),t.classList.contains("active")?e.src="build/img/right_arrow_icon.svg":e.src="build/img/dots_three_circle_icon.svg"}))}))}function showAlert(e,t){const n=document.querySelector(".alerta");n&&n.remove();const s=document.createElement("DIV");s.classList.add("alerta",t),s.textContent=e;const a=document.querySelector("legend");a.parentElement.insertBefore(s,a.nextElementSibling),setTimeout(()=>{s.remove()},5e3)}async function taskBin(e,t,n,s,a,i){return new Promise(async o=>{const c=document.createElement("LI");c.dataset.taskId=e.id,c.classList.add("taskContainer");const d=document.createElement("input");d.type="checkbox",d.classList.add("checkTask"),d.disabled=!0;const l=document.createElement("DIV");l.classList.add("taskHeader"),l.appendChild(d);const r=document.createElement("P");r.textContent=e.title,r.classList.add("taskName"),l.appendChild(r);const m=document.createElement("IMG");m.classList.add("toggleBtn"),m.classList.add("actionImg"),m.alt="Desplegar contenido",m.title="Mostrar información adicional",m.src="build/img/down_arrow_icon.svg";const u=document.createElement("DIV");u.classList.add("taskContentContainer");const p=document.createElement("DIV");p.classList.add("taskInfo");const g=document.createElement("DIV");g.classList.add("taskDescription");const C=document.createElement("IMG");C.classList.add("taskDescriptionIcon"),C.alt="Descripción de la tarea",C.src="build/img/info_icon.svg",g.appendChild(C);const h=document.createElement("P");h.classList.add("taskDescriptionText"),""===e.description?h.textContent="Sin descripción":h.textContent=e.description,g.appendChild(h),p.appendChild(g);const k=document.createElement("DIV");k.classList.add("taskPriority");const y=document.createElement("DIV");y.classList.add("taskPriorityColor");y.style.backgroundColor=["#82E0AA","#F7DC6F","#F1948A"][e.priority],k.appendChild(y);const E=document.createElement("P");E.classList.add("taskPriorityText");E.textContent="Prioridad "+["Baja","Normal","Alta"][e.priority],k.appendChild(E),p.appendChild(k);const L=document.createElement("DIV");L.classList.add("taskStatus");const b=document.createElement("IMG");b.classList.add("taskStatusIcon");b.alt="Imagen del estado de la tarea",b.src=["build/img/pendiente_icon.svg","build/img/progress_icon.svg","build/img/complete_icon.svg"][e.status],L.appendChild(b);const f=document.createElement("P");f.classList.add("taskStatusText");f.textContent=""+["Pendiente","En Progreso","Finalizada"][e.status],L.appendChild(f),p.appendChild(L);const v=document.createElement("DIV");v.classList.add("taskActionsContainer");const w=document.createElement("DIV");w.classList.add("taskActions");const I=document.createElement("IMG");I.title="Menú de acciones",I.src="build/img/dots_three_circle_icon.svg",I.classList.add("taskActionsBtn"),I.classList.add("actionImg");const _=document.createElement("IMG");_.title="Editar tarea",_.src="build/img/edit_icon.svg",_.classList.add("editTaskBtn"),_.classList.add("actionImg"),_.onclick=function(){editTaskModal(e,a,i)};const B=document.createElement("IMG");B.title="Eliminar tarea",B.src="build/img/delete_icon.svg",B.classList.add("deleteTaskBtn"),B.classList.add("actionImg"),B.onclick=function(){Swal.fire({title:"¿Estás seguro que quieres eliminar la tarea?",text:"Esta operación no es reversible",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Borrar"}).then(async t=>{if(t.isConfirmed&&await deleteTask(e)){let e=await getTasks();generalView&&(showTasks(e,a,i),showCalendar(e,a,i)),kanbanView&&showTasksKanban()}})};const D=document.createElement("IMG");D.title="Asignar tarea",D.src="build/img/assign_icon.svg",D.classList.add("assignTaskBtn"),D.classList.add("actionImg"),D.onclick=function(){assignmentsModal(e,a,i)};const M=document.createElement("IMG");M.title="Añadir comentario",M.src="build/img/comment_icon.svg",M.classList.add("commentTaskBtn"),M.classList.add("actionImg"),M.onclick=function(){newCommentsModal(e.id,a,i)};const A=document.createElement("DIV");A.classList.add("taskAssignContainer"),A.dataset.task_id=e.id;const S=document.createElement("H4");S.classList.add("taskAssignTitle"),S.textContent="Asignado a:";const T=document.createElement("DIV");T.classList.add("taskCollaboratorsContainer"),A.appendChild(S),A.appendChild(T);let V=new Array;t.some((function(t){return t.task_id===e.id}))?t.forEach(t=>{t.task_id===e.id&&V.push(t.user_id),viewAssignment(a,i,e,t,n,T)}):A.style.display="none";const x=document.createElement("DIV");x.classList.add("taskComments");const q=await getComments(e.id);if(q.length){const e=document.createElement("H4");e.classList.add("taskCommentsTitle"),e.textContent="Comentarios:",x.appendChild(e),q.forEach(e=>{viewComment(e,x,a,i)})}if(w.appendChild(B),w.appendChild(_),w.appendChild(D),w.appendChild(M),v.appendChild(I),v.appendChild(w),c.appendChild(v),c.appendChild(l),c.appendChild(m),c.appendChild(u),u.appendChild(p),u.appendChild(A),u.appendChild(x),s.appendChild(c),a.id!==i.user_id){v.style.display="none",B.style.display="none",_.style.display="none",M.style.display="none",D.style.display="none";document.querySelectorAll("#addTask").forEach(e=>{e.style.display="none"})}(V.includes(a.id)||i.user_id===a.id)&&(d.disabled=!1,v.style.display="block",_.style.display="block",M.style.display="block"),generalView&&(d.style.display="none"),2==e.status&&(d.checked=!0,d.disabled=!0),o(c)})}closeModalBtns.forEach((function(e){e.addEventListener("click",closeModal)}));